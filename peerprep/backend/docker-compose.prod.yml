# Production Docker Compose Configuration
# This configuration is optimized for cloud deployment
# Use this when deploying to production environments

services:
  # Question Service
  question-service:
    build:
      context: ./question-service
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - SERVER_PORT=3000
      - DATABASE_URL=${QUESTION_SERVICE_DATABASE_URL}
      - LOG_LEVEL=${LOG_LEVEL:-info}
    networks:
      - peerprep-network
    restart: unless-stopped
    deploy:
      replicas: 1
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  # User Service
  user-service:
    build:
      context: ./user-service
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - ENV=PROD
      - DB_CLOUD_URI=${USER_SERVICE_MONGODB_URI}
      - JWT_SECRET=${JWT_SECRET}
      - CORS_ORIGIN=${FRONTEND_URL}
      - LOG_LEVEL=${LOG_LEVEL:-info}
    networks:
      - peerprep-network
    restart: unless-stopped
    deploy:
      replicas: 1
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  # Matching Service
  matching-service:
    build:
      context: ./matching-service
      dockerfile: Dockerfile
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=production
      - PORT=3002
      - ENV=PROD
      - REDIS_CLOUD_URI=${REDIS_CLOUD_URI}
      - JWT_SECRET=${JWT_SECRET}
      - LOG_LEVEL=${LOG_LEVEL:-info}
    networks:
      - peerprep-network
    restart: unless-stopped
    deploy:
      replicas: 1
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  # Collaboration Service
  collaboration-service:
    build:
      context: ./collaboration-service
      dockerfile: Dockerfile
    ports:
      - "3003:3003"
    environment:
      - NODE_ENV=production
      - PORT=3003
      - ENV=PROD
      - REDIS_CLOUD_URI=${REDIS_CLOUD_URI}
      - JWT_SECRET=${JWT_SECRET}
      - SOCKET_CORS_ORIGIN=${FRONTEND_URL}
      - LOG_LEVEL=${LOG_LEVEL:-info}
    networks:
      - peerprep-network
    restart: unless-stopped
    deploy:
      replicas: 1
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

networks:
  peerprep-network:
    driver: bridge